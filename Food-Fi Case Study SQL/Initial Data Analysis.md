# Initial Data Exploration:

1. Retrieve all subscriptions and their start dates:
```sql
      SELECT * FROM subscriptions;
```

2. Retrive the results of plans table
```sql
      SELECT * FROM plans;
```

3. Identify customers who churned:   
 ```sql
      SELECT *
      FROM subscriptions s
      JOIN plans p ON s.plan_id=p.plan_id
      WHERE plan_name="churn";
```

4. Calculate average revenue per user:
```sql
      SELECT customer_id, AVG(price) AS avg_revenue_per_user
      FROM subscriptions s
      JOIN plans p ON s.plan_id=p.plan_id
      GROUP BY customer_id;
```

6. Analyze plan changes:
 ```sql
-- Customer Journey
      SELECT customer_id, plan_name
      FROM subscriptions s
      JOIN plans p ON s.plan_id=p.plan_id
      ORDER BY customer_id, plan_name;
```
7. Determine the most popular plan:
```sql
      SELECT plan_name, COUNT(customer_id) AS plan_count
      FROM subscriptions s
      JOIN plans p ON s.plan_id=p.plan_id
      GROUP BY plan_name;
```
Alternate Solution:
```sql
      SELECT plan_id, COUNT(*) AS num_subscriptions 
      FROM subscriptions 
      GROUP BY plan_id 
      ORDER BY num_subscriptions DESC LIMIT 1;
```
5. Calculate Monthly Revenue: Write a query to calculate the total revenue generated by Foodie-Fi for each month.

```sql
      SELECT DATE_FORMAT(start_date, '%Y-%m') AS month, SUM(price) AS revenue_per_month
      FROM subscriptions s
      JOIN plans p ON s.plan_id=p.plan_id
      GROUP BY month;
```

6. Identify Longest Subscribers: Find the customers who have been subscribed to Foodie-Fi for the longest duration.

```sql
      SELECT customer_id, MIN(start_date) AS subscription_start_date
      FROM subscriptions 
      GROUP BY customer_id
      ORDER BY subscription_start_date;
```

7. Count Plan Changes: Determine the total number of times customers have changed their subscription plans (upgraded or downgraded).
```sql
      SELECT customer_id, COUNT(plan_name) AS plan_changes
      FROM subscriptions s
      JOIN plans p ON s.plan_id=p.plan_id
      GROUP BY customer_id;
```
8. Find Trial Conversions: How many customers converted from the trial plan to a paid subscription plan?
 ```sql
      WITH trial_customers AS (
          -- Select customers who started with the trial plan
          SELECT DISTINCT customer_id
          FROM subscriptions
          WHERE plan_id = 0
      ),
      paid_subscriptions AS (
          -- Select subscriptions with paid plans after the trial period
          SELECT customer_id
          FROM subscriptions
          WHERE plan_id != 0
            AND customer_id IN (SELECT customer_id FROM trial_customers)
      )
      -- Count the number of customers who converted from trial to paid subscription
      SELECT COUNT(DISTINCT customer_id) AS num_converted
      FROM paid_subscriptions;
```

9. Find Trial Conversions: How many customers converted from the trial plan to a pro-annual paid subscription plan?
```sql
      WITH trial_customers AS (
          -- Select customers who started with the trial plan
          SELECT DISTINCT customer_id
          FROM subscriptions
          WHERE plan_id = 0
      ),
      paid_subscriptions AS (
          -- Select subscriptions with paid plans after the trial period
          SELECT customer_id
          FROM subscriptions
          WHERE plan_id = 2
            AND customer_id IN (SELECT customer_id FROM trial_customers)
      )
      -- Count the number of customers who converted from trial to paid subscription
      SELECT COUNT(DISTINCT customer_id) AS num_converted
      FROM paid_subscriptions;
```

10. Revenue Trend Analysis: Compare the revenue generated by Foodie-Fi over different quarters to identify any trends or seasonality.
```sql
      SELECT YEAR(start_date) AS year, QUARTER(start_date) AS quarter, SUM(price) AS revenue_by_quarter
      FROM subscriptions s
      JOIN plans p ON s.plan_id=p.plan_id
      GROUP BY year, quarter;
```

11. Identify High-Churn Periods: Determine if there are any specific periods (months, quarters) where the churn rate significantly increases.
```sql
      SELECT YEAR(start_date) AS year, QUARTER(start_date) AS quarter, COUNT(plan_name) AS churn_count
      FROM subscriptions s
      JOIN plans p ON s.plan_id=p.plan_id
      WHERE plan_name="churn"
      GROUP BY year, quarter
      ORDER BY churn_count DESC;
```

12. Calculate Customer Lifetime Value (CLV): Use the available data to estimate the average CLV for Foodie-Fi customers.
- CLV stands for Customer Lifetime Value, which is a metric used to estimate the total revenue a business can expect from a single customer over the entire duration of their relationship with the company. It helps businesses understand the long-term value of acquiring and retaining customers.
- CLV is typically calculated using historical data on customer behavior and purchase patterns. There are several methods to calculate CLV, but one common approach is the following:

 1. **Calculate Average Revenue per Customer (ARPU)**: This is the average revenue generated from each customer over a specific period. It's calculated by dividing the total revenue by the total number of customers. *ARPU = Total Revenue/Total Number of Customers*

 2. **Calculate Average Customer Lifespan (ACL)**: This is the average length of time a customer continues to do business with the company. It's calculated by averaging the length of time each customer remains active.

 3. **Calculate CLV**: Once you have ARPU and ACL, you can calculate CLV using the following formula: *CLV = ARPU * ACL*

```sql
      WITH customer_tenure AS (
          SELECT 
              customer_id,
              DATEDIFF(MAX(start_date), MIN(start_date)) AS tenure
          FROM 
              subscriptions
          GROUP BY 
              customer_id
      ),
      avg_revenue AS (
          SELECT 
              customer_id,
              COUNT(*) AS num_subscriptions,
              SUM(price) AS total_revenue
          FROM 
              subscriptions
          JOIN 
              plans ON subscriptions.plan_id = plans.plan_id
          GROUP BY 
              customer_id
      )
      -- Calculate CLV
      SELECT 
          AVG(total_revenue / num_subscriptions) * AVG(tenure) AS CLV
      FROM 
          customer_tenure
      JOIN 
          avg_revenue USING(customer_id);
```

13. Customer Retention Analysis: Calculate the retention rate for Foodie-Fi over a specific time period (e.g., monthly or quarterly).
```sql
      SELECT MONTH(start_date) AS month, YEAR(start_date) AS year, QUARTER(start_date) AS quarter, COUNT(DISTINCT(customer_id)) AS customer_retention_rate
      FROM subscriptions s
      JOIN plans p ON s.plan_id=p.plan_id
      GROUP BY month, year, quarter
      ORDER BY customer_retention_rate DESC;
```

14. Identify Inactive Subscribers: Find customers who have not streamed any videos or interacted with the platform for a certain period.
```sql
      SELECT customer_id, MAX(start_date) AS last_subscription_date
      FROM subscriptions
      GROUP BY customer_id
      HAVING MAX(start_date) < DATE_SUB(NOW(), INTERVAL 4 MONTH);
```
15. Average Monthly Revenue per Customer: Calculate the average monthly revenue generated per active subscriber.
```sql
      -- Step 1: Identify active subscribers
      WITH active_subscribers AS (
          SELECT 
              customer_id
          FROM 
              subscriptions
          WHERE 
              plan_id NOT IN (0, 4)  -- Exclude trial and churn plans
      ),
      
      -- Step 2: Calculate monthly revenue per active subscriber
      monthly_revenue AS (
          SELECT s.customer_id, p.price AS monthly_price,
              COUNT(*) AS num_months_subscribed,
              COUNT(*) * p.price AS total_monthly_revenue
          FROM subscriptions s
          JOIN plans p ON s.plan_id = p.plan_id
          WHERE s.plan_id NOT IN (0, 4)  -- Exclude trial and churn plans
          GROUP BY s.customer_id, p.price
      ),
      
      -- Step 3: Compute the average monthly revenue per active subscriber
      average_monthly_revenue AS (
          SELECT 
              AVG(total_monthly_revenue) AS avg_monthly_revenue_per_subscriber
          FROM  monthly_revenue
          JOIN active_subscribers a ON monthly_revenue.customer_id = a.customer_id
      )
      
      -- Final query to get the average monthly revenue per active subscriber
      SELECT avg_monthly_revenue_per_subscriber
      FROM average_monthly_revenue;
```

16. Plan Conversion Rate: Determine the percentage of customers who upgraded or downgraded their subscription plans.
```sql
      -- Step 1: Identify customers who have changed their subscription plans
      WITH plan_changes AS (
          SELECT customer_id,
              LAG(plan_id) OVER (PARTITION BY customer_id ORDER BY start_date) AS previous_plan_id,
              plan_id AS current_plan_id
          FROM subscriptions
      ),
      
      -- Step 2: Count the total number of customers who have upgraded or downgraded
      upgrade_downgrade_count AS (
          SELECT 
              SUM(
                  CASE
                      WHEN previous_plan_id IS NOT NULL AND previous_plan_id <> current_plan_id THEN 1  -- Count upgrades and downgrades
                      ELSE 0
                  END
              ) AS num_upgrades_downgrades
          FROM 
              plan_changes
      ),
      
      -- Step 3: Calculate the percentage of customers who upgraded or downgraded
      plan_conversion_rate AS (
          SELECT num_upgrades_downgrades,
              (num_upgrades_downgrades / (SELECT COUNT(DISTINCT customer_id) FROM subscriptions)) * 100 AS conversion_rate_percentage
          FROM upgrade_downgrade_count
      )
      
      -- Final query to get the plan conversion rate
      SELECT num_upgrades_downgrades,conversion_rate_percentage
      FROM plan_conversion_rate;
```

17. Identify Seasonal Trends: Analyze subscription data to identify any seasonal patterns in customer sign-ups or churn rates.
```sql
      SELECT MONTH(start_date) AS month, YEAR(start_date) AS year, QUARTER(start_date) AS quarter, COUNT(DISTINCT(customer_id)) AS num_subscriptions
      FROM subscriptions s
      JOIN plans p ON s.plan_id=p.plan_id
      GROUP BY month, year, quarter;
```

18. Calculate Subscription Growth Rate: Determine the percentage increase or decrease in the number of subscriptions over a specified time period.
```sql
      SELECT start_date,
     (COUNT(*) - LAG(COUNT(*), 1) OVER (ORDER BY start_date)) / LAG(COUNT(*), 1) OVER (ORDER BY start_date) AS subscription_growth_rate 
      FROM subscriptions
      GROUP BY start_date
```
Explanation: 
- `COUNT(*)`: This counts the number of subscriptions for each start date.
- `LAG(COUNT(*), 1) OVER (ORDER BY start_date)`: This function accesses the count of subscriptions for the previous start date. LAG allows us to access the value of a previous row within the same result set based on the 
   specified ordering (ORDER BY start_date).
- `(COUNT(*) - LAG(COUNT(*), 1) OVER (ORDER BY start_date))`: This calculates the difference in the number of subscriptions between the current and previous dates.
- `(COUNT(*) - LAG(COUNT(*), 1) OVER (ORDER BY start_date)) / LAG(COUNT(*), 1) OVER (ORDER BY start_date)`: This computes the percentage change in the number of subscriptions compared to the previous period. It divides the difference in counts by the count from the previous period to get the growth rate.
In summary, this query calculates the subscription growth rate by comparing the number of subscriptions for each date with the number from the previous date, expressed as a percentage change.
